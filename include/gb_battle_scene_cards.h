#ifndef GB_BATTLE_SCENE_CARDS_H
#define GB_BATTLE_SCENE_CARDS_H

#include "gb_battle_scene_cards.h"

// Dependencies
#include "gb_battle_scene_constants.h"
#include "bn_regular_bg_map_cell.h"
#include "bn_regular_bg_map_item.h"
#include "bn_regular_bg_item.h"
#include "bn_regular_bg_ptr.h"
#include "bn_regular_bg_map_ptr.h"

// Graphics
#include "bn_regular_bg_tiles_items_card_fronts.h"

namespace gb
{
    namespace battle
    {
        // Cell tiles and positions for different cards
        struct cell_graphics_info
        {
        public:
            int x;
            int y;
            int tile_index;
        };

        constexpr cell_graphics_info player_deck_full[16] = {
            {3, 8, 203},
            {4, 8, 204},
            {5, 8, 188},
            {2, 9, 109},
            {3, 9, 205},
            {4, 9, 206},
            {5, 9, 190},
            {2, 10, 191},
            {3, 10, 192},
            {4, 10, 192},
            {5, 10, 189}
        };

        constexpr cell_graphics_info opponent_deck_full[16] = {
            {23, 5, 193},
            {24, 5, 194},
            {25, 5, 195},
            {23, 6, 196},
            {24, 6, 197},
            {25, 6, 198},
            {26, 6, 200},
            {23, 7, 86},
            {24, 7, 202},
            {25, 7, 199},
            {26, 7, 201}
        };

        constexpr cell_graphics_info card_graphics_infos[playmat_spaces][16] = {
            {{2, 11, 128},
             {3, 11, 129},
             {4, 11, 129},
             {2, 12, 137},
             {3, 12, 138},
             {4, 12, 139},
             {2, 13, 154},
             {3, 13, 155},
             {4, 13, 156},
             {1, 14, 173},
             {2, 14, 174},
             {3, 14, 175},
             {4, 14, 176}},
            {{6, 11, 130},
             {7, 11, 129},
             {8, 11, 131},
             {6, 12, 140},
             {7, 12, 138},
             {8, 12, 141},
             {6, 13, 157},
             {7, 13, 155},
             {8, 13, 158},
             {5, 14, 173},
             {6, 14, 174},
             {7, 14, 175},
             {8, 14, 177}},
            {{10, 11, 129},
             {11, 11, 129},
             {12, 11, 132},
             {9, 12, 142},
             {10, 12, 143},
             {11, 12, 138},
             {12, 12, 144},
             {9, 13, 159},
             {10, 13, 160},
             {11, 13, 161},
             {12, 13, 162},
             {9, 14, 178},
             {10, 14, 175},
             {11, 14, 175},
             {12, 14, 179}},
            {{13, 11, 133},
             {14, 11, 129},
             {15, 11, 129},
             {16, 11, 134},
             {13, 12, 145},
             {14, 12, 138},
             {15, 12, 138},
             {16, 12, 146},
             {13, 13, 163},
             {14, 13, 155},
             {15, 13, 155},
             {16, 13, 164},
             {13, 14, 180},
             {14, 14, 175},
             {15, 14, 175},
             {16, 14, 176}},
            {{17, 11, 128},
             {18, 11, 129},
             {19, 11, 129},
             {17, 12, 147},
             {18, 12, 138},
             {19, 12, 148},
             {20, 12, 149},
             {17, 13, 165},
             {18, 13, 166},
             {19, 13, 167},
             {20, 13, 168},
             {17, 14, 181},
             {18, 14, 175},
             {19, 14, 175},
             {20, 14, 177}},
            {{21, 11, 135},
             {22, 11, 129},
             {23, 11, 136},
             {21, 12, 150},
             {22, 12, 138},
             {23, 12, 151},
             {21, 13, 169},
             {22, 13, 155},
             {23, 13, 170},
             {21, 14, 178},
             {22, 14, 175},
             {23, 14, 182},
             {24, 14, 183}},
            {{25, 11, 129},
             {26, 11, 129},
             {27, 11, 132},
             {25, 12, 152},
             {26, 12, 138},
             {27, 12, 153},
             {25, 13, 171},
             {26, 13, 155},
             {27, 13, 172},
             {25, 14, 180},
             {26, 14, 175},
             {27, 14, 182},
             {28, 14, 183}},
            {{3, 9, 90},
             {4, 9, 91},
             {5, 9, 92},
             {2, 10, 109},
             {3, 10, 110},
             {4, 10, 111},
             {5, 10, 112}},
            {{6, 9, 93},
             {7, 9, 94},
             {8, 9, 95},
             {9, 9, 81},
             {6, 10, 113},
             {7, 10, 111},
             {8, 10, 114}},
            {{10, 9, 96},
             {11, 9, 91},
             {12, 9, 97},
             {10, 10, 115},
             {11, 10, 111},
             {12, 10, 116}},
            {{13, 9, 98},
             {14, 9, 99},
             {15, 9, 100},
             {16, 9, 101},
             {13, 10, 117},
             {14, 10, 118},
             {15, 10, 119},
             {16, 10, 120}},
            {{17, 9, 102},
             {18, 9, 91},
             {19, 9, 103},
             {17, 10, 121},
             {18, 10, 111},
             {19, 10, 122}},
            {{20, 9, 78},
             {21, 9, 104},
             {22, 9, 105},
             {23, 9, 106},
             {21, 10, 123},
             {22, 10, 111},
             {23, 10, 124}},
            {{24, 9, 107},
             {25, 9, 91},
             {26, 9, 108},
             {24, 10, 125},
             {25, 10, 111},
             {26, 10, 126},
             {27, 10, 127}},
            {{4, 5, 37},
             {5, 5, 38},
             {6, 5, 39},
             {4, 6, 48},
             {5, 6, 49},
             {6, 6, 50},
             {3, 7, 69},
             {4, 7, 70},
             {5, 7, 71},
             {6, 7, 72}},
            {{7, 5, 40},
             {8, 5, 38},
             {9, 5, 41},
             {7, 6, 51},
             {8, 6, 52},
             {9, 6, 53},
             {7, 7, 73},
             {8, 7, 74},
             {9, 7, 75}},
            {{10, 5, 42},
             {11, 5, 38},
             {12, 5, 43},
             {10, 6, 54},
             {11, 6, 55},
             {12, 6, 56},
             {10, 7, 76},
             {11, 7, 74},
             {12, 7, 77}},
            {{14, 5, 38},
             {15, 5, 38},
             {13, 6, 57},
             {14, 6, 58},
             {15, 6, 59},
             {16, 6, 60},
             {13, 7, 78},
             {14, 7, 79},
             {15, 7, 80},
             {16, 7, 81}},
            {{17, 5, 37},
             {18, 5, 38},
             {19, 5, 44},
             {17, 6, 61},
             {18, 6, 62},
             {19, 6, 63},
             {17, 7, 82},
             {18, 7, 74},
             {19, 7, 83}},
            {{20, 5, 45},
             {21, 5, 38},
             {22, 5, 46},
             {20, 6, 64},
             {21, 6, 52},
             {22, 6, 65},
             {20, 7, 84},
             {21, 7, 74},
             {22, 7, 85}},
            {{23, 5, 47},
             {24, 5, 38},
             {25, 5, 43},
             {23, 6, 66},
             {24, 6, 67},
             {25, 6, 68},
             {23, 7, 86},
             {24, 7, 87},
             {25, 7, 88},
             {26, 7, 89}},
            {{4, 3, 1},
             {5, 3, 2},
             {6, 3, 3},
             {4, 4, 17},
             {5, 4, 18},
             {6, 4, 19}},
            {{7, 3, 4},
             {8, 3, 5},
             {9, 3, 6},
             {7, 4, 20},
             {8, 4, 21},
             {9, 4, 22}},
            {{10, 3, 7},
             {11, 3, 5},
             {12, 3, 8},
             {10, 4, 23},
             {11, 4, 24},
             {12, 4, 25}},
            {{14, 3, 9},
             {15, 3, 8},
             {14, 4, 26},
             {15, 4, 27}},
            {{17, 3, 9},
             {18, 3, 10},
             {19, 3, 11},
             {17, 4, 28},
             {18, 4, 29},
             {19, 4, 30}},
            {{20, 3, 12},
             {21, 3, 10},
             {22, 3, 13},
             {20, 4, 31},
             {21, 4, 32},
             {22, 4, 33}},
            {{23, 3, 14},
             {24, 3, 15},
             {25, 3, 16},
             {23, 4, 34},
             {24, 4, 35},
             {25, 4, 36}},
             };

        struct cards
        {
            static constexpr int columns = 32;
            static constexpr int rows = 32;
            static constexpr int cells_count = columns * rows;

            alignas(int) bn::regular_bg_map_cell cells[cells_count];

            bn::regular_bg_map_item bg_map_item;
            bn::regular_bg_item bg_item;
            bn::regular_bg_ptr bg;
            bn::regular_bg_map_ptr bg_map;

            cards();

            void show_card(int x, int y);
            void hide_card(int x, int y);

            void show_player_deck_full();
            // void show_player_deck_half();
            // void show_player_deck_near();
            void hide_player_deck();
            
            void show_opponent_deck_full();
            // void show_player_deck_half();
            // void show_player_deck_near();
            void hide_opponent_deck();

        private:
            void _update_screen(const cell_graphics_info cells[16], bool show);
        };
    }
}

#endif
